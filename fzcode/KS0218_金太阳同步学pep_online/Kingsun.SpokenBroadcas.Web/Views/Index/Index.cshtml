@{
    ViewBag.Title = "外教直播";
}
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<script src="~/Scripts/js/jquery-1.10.2.min.js"></script>
<script src="~/Scripts/js/JsBridge.js?v=1.2"></script>
<script src="~/Scripts/js/Spokenmodule.js?v=1.2"></script>
<link href="~/Content/css/SpokenOnlive.css?v=1.2" rel="stylesheet" />
<link href="~/Content/css/owl.carousel.css" rel="stylesheet" />
<link href="~/Content/css/owl.theme.css" rel="stylesheet" />
<script src="~/Scripts/js/owl.carousel.js"></script>
<script type="text/javascript"> 
    function addcloud(showName) {//增加页面遮罩
        var bodyWidth = document.documentElement.clientWidth;
        var bodyHeight = window.screen.availHeight; //Math.max(document.documentElement.clientHeight, document.body.scrollHeight);
        var bgObj = document.createElement("div");
        bgObj.setAttribute('id', 'bgDiv');
        bgObj.style.position = "fixed";
        bgObj.style.top = "0px";
        bgObj.style.background = "#000000";
        bgObj.style.filter = "progid:DXImageTransform.Microsoft.Alpha(style=3,opacity=25,finishOpacity=75";
        bgObj.style.opacity = "0.1";
        bgObj.style.left = "0";
        bgObj.style.width = bodyWidth + "px";
        bgObj.style.height = bodyHeight + "px";
        bgObj.style.zIndex = "10000"; //设置它的zindex属性，让这个div在z轴最大，用户点击页面任何东西都不会有反应|
        document.body.appendChild(bgObj); //添加遮罩

        var loadingObj = document.createElement("div");
        loadingObj.setAttribute('id', 'loadingDiv');
        loadingObj.style.position = "fixed";
        loadingObj.style.top = bodyHeight / 2 + "px";
        loadingObj.style.left = bodyWidth / 2 - 18 + "px";
        //loadingObj.style.background = "white";//url(/images/loading.gif)
        loadingObj.innerHTML = "<img style='width:36px;' src=\"/images/loading.gif\" /><p style='color:black'>" + showName + "</P>";//showName
        loadingObj.style.width = "63px";
        loadingObj.style.height = "36px";
        loadingObj.style.zIndex = "10000";
        document.body.appendChild(loadingObj); //添加loading动画-
    }
    function removecloud() {//移除页面遮罩
        $("#loadingDiv").remove();
        $("#bgDiv").remove();
    }
</script>
<script type="text/javascript">
    var statusCode = '@Response.StatusCode';
    //alert(statusCode);
    if (statusCode != 200) {
        window.location.href = "/ErrorPage/Index?type=" + statusCode;
    }
    addcloud("加载中...");
    //alert(1);
    //removecloud();
    //alert(2);
</script>
<!-- Google Tag Manager -->
<script>
    (function (w, d, s, l, i) {
        w[l] = w[l] || []; w[l].push({
            'gtm.start':
            new Date().getTime(), event: 'gtm.js'
        }); var f = d.getElementsByTagName(s)[0],
        j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
        'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
    })(window, document, 'script', 'dataLayer', 'GTM-T3MJ5KG');
</script>
<!-- End Google Tag Manager -->
<div class="langcourses">
    <div class="header">
        <a onclick="finish()" href="#" class="back"><img src="../images/back.png" alt="" /></a>
        <a class="fenxiang" onclick="ShareUrl()" style="display:block;"><img src="../images/shareImg.png" alt="" /></a>
        <h2>外教直播</h2>
    </div>

    <div class="main">

        @*<div class="fadeOut owl-carousel">
                <div class="item">
                    <a onclick="HrefClick()"><img src="../images/banner.png" alt="" /></a>
                </div>
            </div>*@
        <div>
            <div class="item">
                <a onclick="HrefClick()"><img src="../images/banner.png" alt="" style="width: 100%;" /></a>
            </div>
        </div>

        <ul>
            <li class="on">课程列表</li>
            <li>我的课时</li>
        </ul>
        <!--电影课，绘本课-->
        <div class="move chose1">
            @*<a href="movieclass.html" class="course1">
                    <img src="../images/1.jpg" alt="" />
                    <div>
                        <h2>疯狂动物们<span>火爆预约中</span></h2>
                        <p><span class="nianji">年级：<em>1-2</em>年级</span><span class="plan">课程进度：<em>3</em>/<em>20</em></span><span class="stud">已有<em>500</em>人学习</span></p>
                    </div>
                </a>
                <a href="javasrcipt:void(0);" class="course1">
                    <img src="../images/1.jpg" alt="" />
                    <div>
                        <h2>疯狂动物们<span class="finished">已结束</span></h2>
                        <p><span class="nianji">年级：<em>1-2</em>年级</span><span class="plan">课程进度：<em>3</em>/<em>20</em></span><span class="stud">已有<em>500</em>人学习</span></p>
                    </div>
                </a>*@
            @{
                if (ViewData["CourseList"] != null)
                {
                    foreach (var item in ViewData["CourseList"] as List<Kingsun.SpokenBroadcas.Web.Controllers.CourseListModel>)
                    {
                        <a href="/CoursePeriod/Index?CourseType=0&CourseID=@item.ID&UserID=@Request["UserID"]&local=@Request["local"]" class="course1">
                            <img src="@item.BigImage" alt="" />
                            <div>
                                <h2>
                                    @(item.Type == 0 ? "【电影课】" : "【绘本课】")@item.Name
                                    @if (item.CourseState == "0")
                                    {
                                        <span class="finished">已结束</span>
                                    }
                                    else
                                    {
                                        <span>火爆预约中</span>
                                    }
                                </h2>
                                <p><span class="nianji">年级：<em>@item.Groups</em></span><span class="plan">课程进度：<em>@item.QuestionName</em>/<em>@item.Num</em></span><span class="stud">已有<em>@item.AppointNum</em>人学习</span></p>
                            </div>
                        </a>
                    }
                }
            }
        </div>
        <!--我的课时-->
        <div class="move chose2">

            @{
                if (ViewData["MyCoursePeriodList"] != null)
                {
                    <p class="tishi">温馨提示：只能提前@((ViewData["MyCoursePeriodList"] as List<Kingsun.SpokenBroadcas.Web.Controllers.MyCoursePeriodModel>)[0].AheadMinutes)分钟进入教室哦~~</p>
                    foreach (var item in ViewData["MyCoursePeriodList"] as List<Kingsun.SpokenBroadcas.Web.Controllers.MyCoursePeriodModel>)
                    {
                        <div class="room">
                            <img src="@item.BigImage" alt="" />
                            <div class="room_nr">
                                <h3><span>【@(item.Type == 0 ? "电影课" : "绘本课")】</span>@item.AppointCoursePeriodName</h3>
                                <p class="schooltime">上课时间：<span>@item.StartTime.ToString("M月d日 HH:mm")</span></p>
                                <p class="apptime">预约时间：<span>@item.CreateTime.ToString("M月d日 HH:mm")</span></p>
                                <p class="order">
                                    <span>时长：<em>@item.TimeLong</em>分钟</span>
                                    @{
                        if (@item.CoursePeriodState == "已结束")
                        {
                            <a class="finished">已结束</a>
                        }
                        else if (@item.CoursePeriodState == "进入教室")
                        {
                            <a class="entroom" onclick="EnterRoom('@item.UserID','@item.CoursePeriodID','@item.CourseID','@item.CoursePeriodTimeID')">进入教室</a>
                        }
                        else
                        {
                            <a class="notstarted">未开始</a>
                        }
                                    }

                                </p>
                            </div>
                        </div>
                    }
                }
                else
                {
                    <div class="noappoint" style=" width:60%; margin:10px auto 0; padding:10%;">
                        <img src="/images/noappoint.png" alt="" style="width:100%;" />
                    </div>
                    <script type="text/javascript">

                    </script>
                }
            }
            @*<div class="room">
                    <img src="images/feimian.png" alt="" />
                    <div class="room_nr">
                        <h3><span>【电影课】</span>小羊肖恩</h3>
                        <p class="schooltime">上课时间：<span>5月17日 10:00</span></p>
                        <p class="apptime">预约时间：<span>5月16日 10:00</span></p>
                        <p class="order"><span>时长：<em>30</em>分钟</span><a class="entroom">进入教室</a></p>
                    </div>
                </div>
                <div class="room">
                    <img src="images/feimian.png" alt="" />
                    <div class="room_nr">
                        <h3><span>【绘本课】</span>Big pig on a dig</h3>
                        <p class="schooltime">上课时间：<span>5月17日 10:00</span></p>
                        <p class="apptime">预约时间：<span>5月16日 10:00</span></p>
                        <p class="order"><span>时长：<em>30</em>分钟</span><a class="notstarted">未开始</a></p>
                    </div>
                </div>
                <div class="room">
                    <img src="images/feimian.png" alt="" />
                    <div class="room_nr">
                        <h3><span>【绘本课】</span>Big pig on a dig</h3>
                        <p class="schooltime">上课时间：<span>5月17日 10:00</span></p>
                        <p class="apptime">预约时间：<span>5月16日 10:00</span></p>
                        <p class="order"><span>时长：<em>30</em>分钟</span><a class="finished">已结束</a></p>
                    </div>
                </div>*@
            @*<a href="/CoursePeriod/Index?CourseID=" class="course1">
                    <img src="../images/2.jpg" alt="" />
                    <div>
                        <h2>疯狂动物们<span>火爆预约中</span></h2>
                        <p><span class="nianji">年级：<em>1-2</em>年级</span><span class="plan">课程进度：<em>3</em>/<em>20</em></span><span class="stud">已有<em>500</em>人学习</span></p>
                    </div>
                </a>

                <a href="javasrcipt:void(0);" class="course1">
                    <img src="../images/2.jpg" alt="" />
                    <div>
                        <h2>疯狂动物们<span class="finished">已结束</span></h2>
                        <p><span class="nianji">年级：<em>1-2</em>年级</span><span class="plan">课程进度：<em>3</em>/<em>20</em></span><span class="stud">已有<em>500</em>人学习</span></p>
                    </div>
                </a>*@
            @*@{
                    if (ViewData["drawList"] != null)
                    {
                        foreach (var item in ViewData["drawList"] as List<Kingsun.SpokenBroadcas.Web.Controllers.CourseListModel>)
                        {
                            <a href="/CoursePeriod/Index?CourseType=1&CourseID=@item.ID&UserID=@Request["UserID"]&local=@Request["local"]" class="course1">
                                <img src="@item.BigImage" alt="" />
                                <div>
                                    <h2>
                                        @item.Name
                                        @if (item.CourseState == "0")
                                        {
                                            <span class="finished">已结束</span>
                                        }
                                        else
                                        {
                                            <span>火爆预约中</span>
                                        }
                                    </h2>
                                    <p><span class="nianji">年级：<em>@item.Groups</em></span><span class="plan">课程进度：<em>@item.QuestionName</em>/<em>@item.Num</em></span><span class="stud">已有<em>@item.AppointNum</em>人学习</span></p>
                                </div>
                            </a>
                        }
                    }
                }*@
        </div>
    </div>
    <input type="hidden" id="hidenCourseType" value="0" />

</div>
<div style="display:none;">
    <script src="https://s22.cnzz.com/z_stat.php?id=1262360076&web_id=1262360076" language="JavaScript"></script>
</div>
<script type="text/javascript">
    //判断网络
    //var connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection || { tyep: 'unknown' };
    //var type_text = ['unknown', 'ethernet', 'wifi', '2g', '3g', '4g', 'none'];
    //alert(connection.type);
    //if (typeof (connection.type) == "undefined") {
    //    window.location.href = "/ErrorPage/Index";
    //}
    //添加默认图片
    $("img").attr("onerror", "this.src='../images/defaultImg.jpg'");
    $('.fadeOut').owlCarousel({
        items: 1,
        animateOut: 'fadeOut',
        margin: 0,
        autoPlay: true
    });
    //返回
    function finish() {
        window.WebViewJavascriptBridge.callHandler(
        'finish', function (responseData) {

        }
        );
    }
    function HrefClick() {
        var hidenCourseType = $("#hidenCourseType").val();
        window.location.href = "/Banner/Index?UserID=@Request["UserID"]&CourseType=" + hidenCourseType + "&local=@Request["local"]&Banner=1";
    }
    $(function () {

        //如果是分享出去的页面则隐藏分享空间
        var CoursePeriodUrl = GetQueryString("local");
        if (CoursePeriodUrl != null && CoursePeriodUrl.toString().length > 0 && CoursePeriodUrl.toString() == "weixin") {
            $(".header").hide();
            $(".langcourses .main").css("margin-top", "0");
            //$(".fenxiang").hide();
        }
        //alert($("#hidenCourseType").val());
        var CourseType = '@Request["CourseType"]';
        if (CourseType == '' || CourseType == 0) {
            //标题
            $(".langcourses .main ul li").removeClass("on");
            $(".langcourses .main ul li").eq(0).addClass("on");
            //内容
            $(".langcourses .main .move").css("display", "none");
            $(".langcourses .main .chose1").css("display", "block");
        } else {
            //标题
            $(".langcourses .main ul li").removeClass("on");
            $(".langcourses .main ul li").eq(1).addClass("on");
            //内容
            $(".langcourses .main .move").css("display", "none");
            $(".langcourses .main .chose2").css("display", "block");
        }
        //alert(CourseType == '');
    });
    //进入教室
    function EnterRoom(UserID, CoursePeriodID, CourseID, CoursePeriodTimeID) {
        //$.post("/CoursePeriod/AddUserLearn", { UserID: UserID, CoursePeriodTimeID: CoursePeriodTimeID }, function (data) {
        //    data = eval(data);
        //    if (data.Success) {
        //        alert('添加成功');
        //    } else {
        //        alert('添加学习记录失败');
        //    }
        //});
        //return;
        addcloud("加载中...");
        $.post("/CoursePeriod/GetStudioInfo", { UserID: UserID, CoursePeriodID: CoursePeriodID, CoursePeriodTimeID: CoursePeriodTimeID }, function (data) {
            data = eval(data);
            if (data.Success) {
                var StudioInfo = eval(data.Data);
                var CoursePeriodTimeID = StudioInfo[0].ID;
                var StudioUrl = StudioInfo[0].StudioUrl;
                var StudioCommand = StudioInfo[0].StudioCommand;
                //alert(CoursePeriodTimeID);
                //alert("CoursePeriodTimeID=" + CoursePeriodTimeID + ",StudioUrl=" + StudioUrl + ",StudioCommand=" + StudioCommand);
                var Data = { "StudioUrl": StudioUrl, "StudioCommand": StudioCommand, "UserID": UserID, "CoursePeriodTimeID": CoursePeriodTimeID, "CourseID": CourseID };//参数
                window.WebViewJavascriptBridge.callHandler(
                     'enterStudio', Data, function (responseData) {
                         //alert(responseData);
                         if (responseData == "1") {
                             //提交学习记录
                             $.post("/CoursePeriod/AddUserLearn", { UserID: UserID, CoursePeriodTimeID: CoursePeriodTimeID }, function (data) {
                                 data = eval(data);
                                 if (data.Success) {
                                     alert('添加成功');
                                 } else {
                                     alert('添加学习记录失败');
                                 }
                             });
                         } else {
                             alert('进入直播间失败');
                         }
                     }
                );
            } else {
                alert(data.Msg);
            }
            removecloud();
        });
        setInterval("removecloud()", 5000);
    }
    //分享
    function ShareUrl() {
        //alert(window.location.hostname + "/Index/Index?UserID=0&local=weixin");
        //alert(window.location.href.replace(GetQueryString("UserID"), "0").replace("&local=", "") + "&local=weixin");
        var hostName = window.location.hostname;
        var port = window.location.port;
        if (port != null && port != "") {
            hostName = hostName + ':' + port;
        }
        //alert(hostName);
        //调用移动端接口
        var data = {
            //传递的参数json
            "data": {
                "shareUrl": hostName + "/Index/Index?UserID=0&local=weixin"
            }
        };
        //data = eval(data);
        //alert(data.data.title);
        //调用移动端的方法
        window.WebViewJavascriptBridge.callHandler(
            'shareThirdparty', data, function (responseData) {

            }
        );
    }
</script>
<!-- Google Tag Manager (noscript) -->
<noscript>
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T3MJ5KG"
            height="0" width="0" style="display:none;visibility:hidden"></iframe>
</noscript>
<!-- End Google Tag Manager (noscript) -->
@{
    if (ViewData["ReMoveCloud"] == null)
    {
        <script type="text/javascript">

            setInterval("removecloud()", 5000);
        </script>
    }
    else
    {
        <script type="text/javascript">
            @ViewData["ReMoveCloud"];
        </script>
    }
}