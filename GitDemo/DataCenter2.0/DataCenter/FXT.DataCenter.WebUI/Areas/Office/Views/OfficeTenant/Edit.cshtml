@model FXT.DataCenter.Domain.Models.DatTenantOffice
@{
    ViewBag.Title = "办公租客";
}

@section StyleSheet{
    <link href="~/Content/Scripts/autocomplete/jquery.autocomplete.css" rel="stylesheet" />
    <style type="text/css">
        #tbInputCon
        {
            margin-top: 10px;
            margin-left: 30px;
            width: 95%;
            font-size: 14px;
            font-weight: normal;
            line-height: 20px;
            font-family: "Microsoft Yahei", "微软雅黑", "宋体", "Simsun", "Open Sans";
        }

        .required
        {
            color: red;
        }

        .btn
        {
            margin-bottom: 10px;
        }
    </style>

}
@section JavaScript{
    <script src="@Url.Content("~/Content/Scripts/autocomplete/jquery.autocomplete.min.js")" type="text/javascript"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $("#JoinDate, #SurveyDate").datepicker({
                format: "yyyy-mm-dd",
            });

            //面包屑导航
            $("#navigation .breadcrumb li:eq(1)").remove();
            $("#navigation .breadcrumb li:eq(2)").remove();
            var html = "<li><span><a href=\"javascript:history.go(-1);\">租客数据</a></span> <i class=\"icon-angle-right\"></i></li>";
            if ('@Model' == "") {
                html += "<li><span>新增</span></li>";
            } else {
                html += "<li><span>编辑</span></li>";
            }
            $("ul.breadcrumb").append(html);

            //行政区联动
            $("#AreaId").change(function () {
                //商务中心
                $.get('@Url.Action("GetSubAreaId")', { AreaId: $("#AreaId").val() }, function (data) {
                    $("#SubAreaId").html("");
                    $.each(data, function (i, item) {
                        $("#SubAreaId").append($("<option></option>").val(item.Value).html(item.Text));
                    });
                });

                //办公楼盘
                $.get('@Url.Action("GetOfficeProject")', { areaId: $("#AreaId").val(), subAreaId: $("#SubAreaId").val() }, function (data) {
                    $("#ProjectId").html("");
                    $.each(data, function (i, item) {
                        $("#ProjectId").append($("<option></option>").val(item.Value).html(item.Text));
                    });
                    $("#ProjectOtherName").val("");
                });

                //办公楼栋
                $.get('@Url.Action("GetOfficeBuilding")', { areaId: $("#AreaId").val(), subAreaId: $("#SubAreaId").val(), projectId: $("#ProjectId").val() }, function (data) {
                    $("#BuildingId").html("");
                    $.each(data, function (i, item) {
                        $("#BuildingId").append($("<option></option>").val(item.Value).html(item.Text));
                    });
                    $("#BuildingOtherName").val("");
                });
            });

            //商务中心联动
            $("#SubAreaId").change(function () {
                //办公楼盘
                $.get('@Url.Action("GetOfficeProject")', { areaId: $("#AreaId").val(), subAreaId: $("#SubAreaId").val() }, function (data) {
                    $("#ProjectId").html("");
                    $.each(data, function (i, item) {
                        $("#ProjectId").append($("<option></option>").val(item.Value).html(item.Text));
                    });
                    $("#ProjectOtherName").val("");
                });

                //办公楼栋
                $.get('@Url.Action("GetOfficeBuilding")', { areaId: $("#AreaId").val(), subAreaId: $("#SubAreaId").val(), projectId: $("#ProjectId").val() }, function (data) {
                    $("#BuildingId").html("");
                    $.each(data, function (i, item) {
                        $("#BuildingId").append($("<option></option>").val(item.Value).html(item.Text));
                    });
                    $("#BuildingOtherName").val("");
                });
            });

            //楼盘联动
            $("#ProjectId").change(function () {
                //办公楼盘别名
                $.get('@Url.Action("GetOfficeProjectOtherName")', { areaId: $("#AreaId").val(), subAreaId: $("#SubAreaId").val(), projectId: $("#ProjectId").val() }, function (data) {
                    $("#ProjectOtherName").val(data);
                });
                //办公楼栋
                $.get('@Url.Action("GetOfficeBuilding")', { areaId: $("#AreaId").val(), subAreaId: $("#SubAreaId").val(), projectId: $("#ProjectId").val() }, function (data) {
                    $("#BuildingId").html("");
                    $.each(data, function (i, item) {
                        $("#BuildingId").append($("<option></option>").val(item.Value).html(item.Text));
                    });
                    $("#BuildingOtherName").val("");
                });
            });

            //楼栋联动
            $("#BuildingId").change(function () {
                //办公楼栋别名
                $.get('@Url.Action("GetOfficeBuildingOtherName")', { projectId: $("#ProjectId").val(), buildingId: $("#BuildingId").val() }, function (data) {
                    $("#BuildingOtherName").val(data);
                });
            });

            //行业大类联动
            $("#TypeCode").change(function () {
                $.post('@Url.Action("GetSubTypeCode")', { TypeCode: $("#TypeCode").val() }, function (data) {
                    $("#SubTypeCode").html("");
                    $.each(data, function (i, item) {
                        $("#SubTypeCode").append($("<option></option>").val(item.Value).html(item.Text));
                    });
                });
            });

            $('#TenantName').autocomplete('@Url.Action("TenantNameSelect")', {
                max: 12,    //列表里的条目数
                minChars: 0,    //自动完成激活之前填入的最小字符
                width: 218,     //提示的宽度，溢出隐藏
                scrollHeight: 200,   //提示的高度，溢出显示滚动条
                matchContains: true,    //包含匹配，就是data参数里的数据，是否只要包含文本框里的数据就显示
                autoFill: false,    //自动填充
                parse: function (data) {
                    return $.map(eval(data), function (row) {
                        return {
                            data: row,
                            value: row.name, //显示结果
                            result: row.id  //填充结果
                        }
                    });
                },
                formatItem: function (row, i, max) {
                    return row.name;
                },
                formatMatch: function (row, i, max) {
                    return row.name;
                },
                formatResult: function (row) {
                    return row.name;
                }
            }).result(function (event, row, formatted) {
                $('#TenantName').val(row.name);
                $("#TenantID").val(row.id);
            });

            //确定
            $("#btnSave").bind("click", function () {
                var areaId = $("#AreaId").val();
                //var subAreaId = $("#SubAreaId").val();
                var projectId = $("#ProjectId").val();
                var buildingId = $("#BuildingId").val();

                var surveyDate = $("#SurveyDate").val();
                var tenantName = $.trim($("#TenantName").val());
                var typeCode = $("#TypeCode").val();

                if (areaId == -1 || projectId == -1 || buildingId == -1 || surveyDate == "" || tenantName == "" || typeCode == -1) {
                    if (areaId == -1) {
                        $("#msgForAreaId").text("*必选");
                    }
                    else {
                        $("#msgForAreaId").text("*");
                    }

                    if (projectId == -1) {
                        $("#msgForProjectId").text("*必选");
                    }
                    else {
                        $("#msgForProjectId").text("*");
                    }
                    if (buildingId == -1) {
                        $("#msgForBuildingId").text("*必选");
                    }
                    else {
                        $("#msgForBuildingId").text("*");
                    }
                    if (surveyDate == "") {
                        $("#msgForSurveyDate").text("*必填");
                    }
                    else {
                        $("#msgForSurveyDate").text("*");
                    }
                    if (tenantName == "") {
                        $("#msgForTenantName").text("*必填");
                    }
                    else {
                        $("#msgForTenantName").text("*");
                    }
                    if (typeCode == -1) {
                        $("#msgForTypeCode").text("*必选");
                    }
                    else {
                        $("#msgForTypeCode").text("*");
                    }
                    return;
                }
                else {
                    $("#msgForAreaId").text("*");
                    $("#msgForProjectId").text("*");
                    $("#msgForBuildingId").text("*");
                    $("#msgForSurveyDate").text("*");
                    $("#msgForTenantName").text("*");
                    $("#msgForTypeCode").text("*");
                }

                $("#mainForm").submit();
            });
        });

    </script>
}

@using (Html.BeginForm(null, null, FormMethod.Post, new { id = "mainForm" }))
{
    <table id="tbInputCon" class="tbInputCon">
        <tr>
            <td>行政区:
            </td>
            <td>
                @if (Model != null)
                {
                    @Html.HiddenFor(m => m.ProjectId)
                    @Html.HiddenFor(m => m.BuildingId)
                    @Html.HiddenFor(m => m.HouseTenantId)
                    @Html.HiddenFor(m => m.CityId)
                    @Html.HiddenFor(m => m.FxtCompanyId)
                    @Html.HiddenFor(m => m.TenantID)
                    @Html.TextBoxFor(m => m.AreaName, new { @readonly = "readonly" })
                }
                else
                {                  
                    @Html.HiddenFor(m => m.TenantID, new { Value = -1 })  
                    @Html.DropDownListFor(m => m.AreaId, ViewBag.AreaName as List<SelectListItem>)
                    <span class="required" id="msgForAreaId">*</span>
                }
            </td>
            <td>商务中心:
            </td>
            <td>
                @if (Model != null)
                {
                    @Html.TextBoxFor(m => m.SubAreaName, new { @readonly = "readonly" })
                }
                else
                {
                    @Html.DropDownListFor(m => m.SubAreaId, ViewBag.SubAreaName as List<SelectListItem>)
                }
            </td>
        </tr>
        <tr>
            <td>办公楼盘：
            </td>
            <td>
                @if (Model != null)
                {
                    @Html.TextBoxFor(m => m.ProjectName, new { @readonly = "readonly" })
                }
                else
                {
                    @Html.DropDownListFor(m => m.ProjectId, ViewBag.ProjectName as List<SelectListItem>)
                    <span class="required" id="msgForProjectId">*</span>
                }
            </td>
            <td>楼盘别名：
            </td>
            <td>
                @Html.TextBoxFor(m => m.ProjectOtherName, new { @readonly = "readonly" })
            </td>
        </tr>
        <tr>
            <td>办公楼栋：
            </td>
            <td>
                @if (Model != null)
                {
                    @Html.TextBoxFor(m => m.BuildingName, new { @readonly = "readonly" })
                }
                else
                {
                    @Html.DropDownListFor(m => m.BuildingId, ViewBag.BuildingName as List<SelectListItem>)
                    <span class="required" id="msgForBuildingId">*</span>
                }
            </td>
            <td>楼栋别名：
            </td>
            <td>
                @Html.TextBoxFor(m => m.BuildingOtherName, new { @readonly = "readonly" })
            </td>
        </tr>
        <tr>
            <td>调查时间：
            </td>
            <td>
                @Html.TextBoxFor(m => m.SurveyDate, new { Value = @Model != null ? string.Format("{0:yyyy-MM-dd}", @Model.SurveyDate) : "" })
                <span class="required" id="msgForSurveyDate">*</span>
            </td>
            <td>调查人：
            </td>
            <td>
                @Html.TextBoxFor(m => m.SurveyUser)
            </td>
        </tr>
        <tr>
            <td>楼层：
            </td>
            <td>
                @Html.TextBoxFor(m => m.FloorNum)
            </td>
            <td>房号：
            </td>
            <td>
                @Html.TextBoxFor(m => m.HouseName)
            </td>
        </tr>
        <tr>
            <td>租客名称:
            </td>
            <td>
                @Html.TextBoxFor(m => m.TenantName)
                <span class="required" id="msgForTenantName">*</span>
            </td>
            <td>是否空置：
            </td>
            <td>
                @Html.DropDownListFor(m => m.IsVacant, new List<SelectListItem> { new SelectListItem { Value = "0", Text = "否" }, new SelectListItem { Value = "1", Text = "是" } })
            </td>
        </tr>
        <tr>
            <td>租赁面积(㎡):
            </td>
            <td>
                @Html.TextBoxFor(m => m.BuildingArea)
            </td>
            <td>租金单价(元/㎡*月):
            </td>
            <td>
                @Html.TextBoxFor(m => m.Rent)
            </td>
        </tr>
        <tr>
            <td></td>
            <td>
                @Html.ValidationMessageFor(m => m.BuildingArea)
            </td>
            <td></td>
            <td>
                @Html.ValidationMessageFor(m => m.Rent)
            </td>
        </tr>
        <tr>
            <td>行业大类:
            </td>
            <td>
                @Html.DropDownListFor(m => m.TypeCode, ViewBag.TypeCodeName as List<SelectListItem>)
                <span class="required" id="msgForTypeCode">*</span>
            </td>
            <td>行业小类:
            </td>
            <td>
                @Html.DropDownListFor(m => m.SubTypeCode, ViewBag.SubTypeCodeName as List<SelectListItem>)
            </td>
        </tr>
        <tr>
            <td>进驻时间:
            </td>
            <td>
                @Html.TextBoxFor(m => m.JoinDate, new { Value = @Model != null ? string.Format("{0:yyyy-MM-dd}", @Model.JoinDate) : "" })
            </td>
            <td>是否典型租客:
            </td>
            <td>
                @Html.DropDownListFor(m => m.IsTypical, new List<SelectListItem> { new SelectListItem { Value = "0", Text = "否" }, new SelectListItem { Value = "1", Text = "是" } })
            </td>
        </tr>
        <tr>
            <td>备注:
            </td>
            <td colspan="3">
                @Html.TextBoxFor(m => m.Remarks)
            </td>
        </tr>
        <tr>
            <td colspan="4" style="padding-top: 10px;">
                <a id="btnSave" class="btn blue" title='保存'><i class="icon-ok"></i>保存</a>
            </td>
        </tr>
    </table>
}