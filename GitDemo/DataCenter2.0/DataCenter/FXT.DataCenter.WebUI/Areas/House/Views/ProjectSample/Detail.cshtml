@using Webdiyer.WebControls.Mvc
@using FXT.DataCenter.Domain.Models
@model PagedList<DAT_SampleProject_Weight>
@{
    //Layout = "~/Views/Shared/_Layout.Content.cshtml";
    ViewBag.Title = "样本楼盘关联楼盘";
}
@section StyleSheet{
    <style type="text/css">
        select {
            margin: 1px;
            width: 150px;
        }

        #hourslider {
            display: inline-block;
            width: 120px;
            margin-top: 10px;
            margin-left: 30px;
        }
    </style>
}
@section Javascript{
    <script type="text/javascript">
        $(document).ready(function () {
            $("#checkall").click(function () {
                var ischecked = this.checked;
                $("input:checkbox[name='ids']").each(function () {
                    this.checked = ischecked;
                });

                $.uniform.update(':checkbox');
            });

            $("#btnDetailAdd").click(function () {
                var buildingTypeCode = $("#buildingTypeCode").val();
                if (buildingTypeCode == -1) {
                    alert("建筑类型为空，请检查！");
                    return;
                }

                var weight = parseFloat($("#weight").val());
                if (isNaN(weight)) {
                    alert("系数为空或格式不正确，请检查！");
                    return;
                }

                if (weight < 0.3 || weight > 5) {
                    alert("系数必须大于等于0.3小于等于5，请检查！");
                    return;
                }
                $.post('@Url.Action("DetailAdd")', { sampleProjectId: '@ViewBag.sampleProjectId', projectId: $("#projectname").val(), buildingTypeCode: $("#buildingTypeCode").val(), weight: $("#weight").val() }, function (data) {
                    if (data.result) {
                        location.reload();
                    } else {
                        if (data.msg != "") {
                            alert(data.msg);
                        } else {
                            alert("操作失败！");
                        }

                    }
                });
            });

            $("#btnDetailDelete").click(function () {

                var ids = [];
                var checks = $("input[name='ids']:checked");
                if (checks.length == 0) {
                    alert("请选择要删除的数据");
                    return;
                }

                if (confirm("是否确定删除？")) {
                    checks.each(function () {
                        ids.push($(this).val());
                    });
                    $.ajax({
                        type: "POST",
                        url: '@Url.Action("DetailDelete")',
                        data: { ids: ids },
                        traditional: true,
                        success: function (data) {
                            if (data) {
                                location.reload();
                            } else {
                                alert("操作失败，或者您没有权限修改样本楼盘！");
                            }
                        }
                    });
                }

            });


            $("#projectname").select2({
                minimumInputLength: 2,
                ajax: {
                    url: "@Url.Action("ProjectSelect")",
                    dataType: 'json',
                    data: function (term, page) {
                        return {
                            key: term,
                            projectId: '@ViewBag.projectId'
                        };
                    },
                    results: function (data, page) {
                        return { results: data };
                    }
                },
                formatResult: function (data) {
                    return data.text;
                },
                formatSelection: function (data) {
                    return data.text;
                },
                matcher: function (term, text) {
                    var mod = ZhToPinyin(text);
                    var tf1 = mod.a.toUpperCase().indexOf(term.toUpperCase()) == 0;
                    var tf2 = mod.b.toUpperCase().indexOf(term.toUpperCase()) == 0;
                    return (tf1 || tf2);
                }
            });
            $(".select2-container").width(221); //重置select2宽度
            $(".select2-container").css("display", "inline-table");
        });
    </script>
}
<div>
    @using (Html.BeginForm(null, null, null, FormMethod.Get, new { id = "search", @class = "well form-inline" }))
    { 
        <div style="margin-left: 15px;">
            <table>
                <tr>
                    <td colspan="4" style="width: 600px;"><a style="color: green; text-decoration: none;">样本楼盘：@Html.Raw(ViewBag.sampleprojectname)</a>
                    </td>
                </tr>
                <tr>
                    <td><b style="color: Red;">*</b> 关联楼盘：</td>
                    <td colspan="3">
                        @Html.Hidden("projectname")</td>
                </tr>
                <tr>
                    <td><b style="color: Red;">*</b> 建筑类型：
                    </td>
                    <td>
                        @Html.DropDownList("buildingTypeCode", ViewBag.BuildingTypeCodeNameList as IEnumerable<SelectListItem>, new { @class = "m-wrap small" })
                    </td>
                    <td><b style="color: Red;">*</b> 系数：
                    </td>
                    <td>
                        @Html.TextBox("weight", null, new { @class = "m-wrap small" })</td>
                </tr>
            </table>
        </div>        
        <div style="margin-left: 15px;">
            <input id="btnDetailAdd" type="button" class="btn" value="新 增" />
            &nbsp;&nbsp;
            <input id="btnDetailDelete" type="button" class="btn" value="删 除" />
            <input type="hidden" name ="projectId" value="@ViewBag.sampleprojectid" />
            <input type="hidden" name ="projectName" value="@ViewBag.sampleprojectname" />
            <input type="hidden" name ="companyId" value="@ViewBag.sampleprojectname" />
        </div>
    }
</div>
@using (Html.BeginForm("DetailDelete", "ProjectSample", FormMethod.Post, new { id = "mainForm" }))
{
    <table class="table table-striped table-hover ">
        <thead>
            <tr>
                <th style="width: 8px;">
                    <input type="checkbox" id="checkall" class="group-checkable" />
                </th>
                <th>关联楼盘
                </th>
                <th>建筑类型
                </th>
                <th>系数
                </th>
            </tr>
        </thead>
        <tbody>
            @foreach (var m in Model)
            {
                <tr>
                    <td>
                        <input type="checkbox" class="checkboxes" name='ids' value='@m.Id' />
                    </td>
                    <td>
                        @m.ProjectName
                    </td>
                    <td>
                        @m.BuildingTypeCodeName
                    </td>
                    <td>
                        @m.Weight
                    </td>
                </tr>
            }
        </tbody>
    </table>
}
<div class="pager">
    <div>共 @Model.TotalPageCount 页 @Model.TotalItemCount 条记录,当前为第 @Model.CurrentPageIndex 页</div>
    @Html.Pager(Model, new PagerOptions { AutoHide = false })
</div>
