@using FXT.DataCenter.Domain.Models;
@using Webdiyer.WebControls.Mvc
@model PagedList<DAT_Project>
@{

    ViewBag.Title = "(住宅)楼盘";
}
@section StyleSheet{
    <style type="text/css">
        select {
            margin: 1px;
            width: 150px;
        }

        .p5 {
            padding: 0px;
            padding-top: 5px;
            line-height: 200%;
            background: #fbfbfb;
        }

            .p5 label {
                width: 100px;
            }

            .p5 select {
                width: 133px;
            }

        #hourslider {
            display: inline-block;
            width: 120px;
            margin-top: 10px;
            margin-left: 30px;
        }

        .scrollBar {
            width: 100%;
            overflow: scroll;
            overflow-x: scroll;
            overflow-y: hidden;
        }

        td a {
            padding-left: 25px;
            padding-right: 25px;
        }
    </style>
}
@section Javascript{
    <script type="text/javascript">
        var UrlDelete = '@Url.Action("DeleteProject")';
        $(document).ready(function () {
            //日期控件渲染
            $("#startdate,#startenddate, #enddate").datepicker({ format: 'yyyy-mm-dd' });
            $("#areaid").change(function () {
                var areaId = $(this).find("option:selected").val();
                $.get('@Url.Action("GetSubArea")', { areaId: areaId }, function (data) {
                    $("#subareaid").html("");
                    $.each(data, function (i, item) {
                        $("#subareaid").append($("<option></option>").val(item.Value).html(item.Text));
                    });
                });
            });
            $("button[id='btnImport']").bind("click", function () {
                $("#span11_btnOKImpot").show();
                return false;
            });
            $("#btnOKImpot").bind("click", function () {
                var execl = (/\.xls$|\.xlsx$/i);
                if (!execl.test($("#filepath").val())) {
                    alert("请你上传xls或者xlsx格式的文件");
                    return false;
                }
                return true;
            });
            //导出
            $("#btnExport").bind("click", function () {
                var project = {};
                project.areaid = $("#areaid").val();
                project.rightcode = $("#rightcode").val();
                project.fieldno = $("#fieldno").val();
                project.key = $("#key").val();
                project.subareaid = $("#subareaid").val();
                project.buildingtypecode = $("#buildingtypecode").val();
                project.planpurpose = $("#planpurpose").val();
                project.usableyear = $("#usableyear").val();

                var request = JSON.stringify(project);
                window.location.href = '@Url.Action("Export")' + "?project=" + request;
            });
            $("#btnAll").bind("click", function () {
                $("#search").attr("action", "/House/Project/Index");
            });

            //删除
            $("#delete").unbind();
            $("#delete").click(function () {
                var ids = [];
                var checks = $("input[name='ids']:checked");
                if (checks.length == 0) {
                    alert("请选择要删除的数据");
                    return;
                }
                if (confirm("是否确定删除？")) {
                    checks.each(function () {
                        ids.push($(this).val());
                    });
                    $.ajax({
                        type: "POST",
                        url: UrlDelete,
                        data: { ids: ids },
                        traditional: true,
                        success: function (data) {
                            if (data.result) {
                                if (data.msg != "") {
                                    alert(data.msg);
                                }
                                location.reload();
                            } else {
                                alert(data.msg);
                            }
                        }
                    });
                }

            });

        });

    </script>
    @{Html.RegisterMvcPagerScriptResource();}
}
<div style="text-align: right;">
    <a style="cursor: pointer;" id="control">收起∧</a>
</div>
<div class="row-fluid" id="condi">
    @using (Html.BeginForm("Index", "Project", FormMethod.Get, new { id = "search", @class = "form-inline" }))
    {
        <table style="width: 100%; margin-bottom: 10px; line-height: 35px;">
            <tr>
                <td>行政区：
                </td>
                <td>
                    @Html.DropDownList("areaid")
                </td>
                <td>建筑物类型：
                </td>
                <td>
                    @Html.DropDownList("buildingtypecode")
                </td>

            </tr>
            <tr>
                <td>片区：
                </td>
                <td>@Html.DropDownList("subareaid")
                </td>
                <td>用途：
                </td>
                <td>@Html.DropDownList("planpurpose")
                </td>
            </tr>
            <tr>
                <td>楼盘关键字:
                </td>
                <td>@Html.TextBox("key", null, new { @style = "width: 137px;" })
                </td>
                <td>模糊搜索:
                </td>
                <td>@Html.TextBox("keystring", null, new { @style = "width: 137px;" })
                </td>
            </tr>
            <tr>
                <td colspan="4">
                    <a class="btn blue" title='添加楼盘基础信息'  href="@Url.Action("Create")">
                        <i class="icon-plus icon-white"></i>新增 </a>&nbsp; <a class="btn red" id="delete"
                            href="javascript:void(0);"><i class="icon-trash icon-white"></i>删除
                        </a>
                    <button type="submit" id="btnAll" name="command" class="btn" value="all">
                        查询 <i class="icon-search"></i>
                    </button>
                    <a id="btnCount" class = "btn" href="@Url.Action("Count")">统计</a>
                    @if (ViewBag.IsExport)
                    {
                        <a id="btnExport" class="btn">一键导出</a>
                        <a id="btnStatitics"  class = "btn" href="@Url.Action("ProjectStatistics")">自定义导出</a>
                    }

                    <a class="btn" title="上传楼盘" id="btnImportProject" href="@Url.Action("UploadFile")"><i class="icon-upload-alt">楼盘批量上传</i></a>
                    <a class="btn" title="上传楼盘配套" id="btnImportProjectPeiTao" href="@Url.Action("ImportPeiTao")"><i class="icon-upload-alt">楼盘配套批量上传</i></a>
                    <a class="btn" title="上传楼栋" id="btnImportBuilding" href="@Url.Action("ImportBuilding")"><i class="icon-upload-alt">楼栋批量上传</i></a>
                    <a class="btn" title="上传房号" id="btnImportHouseNo" href="@Url.Action("ImportHouseNo")"><i class="icon-upload-alt">房号批量上传</i></a>
                </td>
            </tr>
            <tr>
                <td colspan="4">
                    <a class="btn" title="楼盘图片批量上传" id="btnProjectPic" href="@Url.Action("BatchAddProjectPic")"><i class="icon-upload-alt">楼盘图片批量上传</i></a>
                    <a class="btn" title="楼栋图片批量上传" id="btnBuildingPic" href="@Url.Action("BatchAddBuildingPic")"><i class="icon-upload-alt">楼栋图片批量上传</i></a>
                    <a class="btn" title="房号系数差批量设置" id="btnHouseCoefficient" href="@Url.Action("index", "HouseRatio")?fpPageIndex=1"><i class="icon-upload-alt">房号系数差批量设置</i></a>
                </td>
            </tr>
        </table>
    }

</div>
@using (Html.BeginForm("DeleteProject", "Project", FormMethod.Post, new { id = "mainForm" }))
{

    <div class="scrollBar">
        <table class="table table-striped table-hover ">
            <thead>
                <tr>
                    <th style="width: 8px;">
                        <input type="checkbox" id="checkall" class="group-checkable" />
                    </th>
                    <th>行政区</th>
                    <th>片区</th>
                    <th>楼盘名称</th>
                    <th>楼盘别名</th>
                    <th>楼盘地址</th>
                    <th>数据建设机构</th>
                    <th style="padding-left: 25px; padding-right: 25px;">楼栋数</th>
                    <th>总套数</th>
                    <th style="width: 59px;">操作</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var m in Model)
                {
                    var chValue = m.fxtcompanyid + "#" + m.projectid;
                    <tr>
                        <td>
                            <input type="checkbox" class="checkboxes" name='ids' id="ids" value='@chValue' />
                        </td>
                        <td>
                            @m.AreaName
                        </td>
                        <td>
                            @m.SubAreaName
                        </td>
                        <td>
                            <a title='@m.projectname' href="@Url.Action("Edity", new { projectid = chValue })">@m.projectname</a>
                        </td>
                        <td>
                            @m.othername
                        </td>
                        <td>
                            @if (!string.IsNullOrEmpty(m.address))
                            {
                                <div style="width:180px; overflow:hidden; white-space:nowrap; text-overflow:ellipsis;" title="@m.address">@m.address</div>
                            }
                        </td>
                        <td style="cursor:pointer;">
                            <div style="width:100px; overflow:hidden; white-space:nowrap; text-overflow:ellipsis;" title="@m.belongcompanyname">@m.belongcompanyname</div>                            
                        </td>
                        <td>
                            <a class="btn mini btn-xs blue" href="@Url.Action("Index", "Build", new { m.projectid })"><i class=" icon-share-alt"></i>&nbsp;@m.BuildingNumber
                            </a>
                        </td>
                        <td>
                            <a class="btn mini btn-xs blue">@m.HouseNumber </a>
                        </td>
                        <td>
                            <a class="btn mini purple" title='编辑' href="@Url.Action("Edity", new { projectid = chValue })">
                                <i class="icon-edit"></i>编辑 </a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}
<div class="pager">
    @{
        var totalPageCount = Model == null ? 0 : Model.TotalPageCount;
        var totalItemCount = Model == null ? 0 : Model.TotalItemCount;
        var currentPageIndex = Model == null ? 0 : Model.CurrentPageIndex;
    }
    <div>共 @totalPageCount 页 @totalItemCount 条记录,当前为第 @currentPageIndex 页</div>
    @if (Model != null && Model.Any())
    {
        @Html.Pager(Model, new PagerOptions { AutoHide = false, ShowPageIndexBox = true, PageIndexBoxType = PageIndexBoxType.TextBox })
    }
</div>
